<!--
    Title: mclaurine-bobs-auto-repair.html, 
    Author: Trevor McLaurine
    Date: 4/11/2023
    Description: The HTML for Bob's Auto Repair Shop
-->

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="../flex-layout.css">
    <link rel="stylesheet" href="../site.css">
    <link rel="stylesheet" href="../theme.css">
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Oswald:wght@300;400;500;700&display=swap">
    <title>WEB 330 - Enterprise JavaScript II</title>
</head>
<body class="light-theme">
    <div id="container">
        <h1 class="app-header">Welcome to the WhatABook, Part 1 App!</h1>
        <div class="card">
            <div class="card-title">Book Listing</div>
            <div class="card-content" id="bookList">
                <table id="bookTable" class="table">
                    <tbody>
                        <tr>
                            <td value="ISBN">ISBN</td>
                            <td value="title">Title</td>
                            <td value="description">Description</td>
                            <td value="pages">Pages</td>
                            <td value="authors">Authors</td>
                        </tr>
                    </tbody>
                </table>
            </div>
        </div>
        <div class="card">
            <div class="card-title">Selected Book</div>
            <div class="card-content" id="selectedBook">
            </div>
        </div>
        <a class="return-home" href="../index.html">Return</a>
    </div>
</body>
<script type="module">
    const bookTable = document.querySelector('tbody')
   document.addEventListener("DOMContentLoaded", () => {

    let fileName = 'books.xml';

    function anchorClicked(e) {
        e.preventDefault()

        let self = this; 
        let cell = self.parentElement;  

        let data = cell.querySelectorAll('td')

        let bookData = `<ul style="list-style: none;"></ul>`

        console.log(data)

        for (let field of data) {
            bookData += `<li><b>${field.dataset.value}</b></li>`
        }

        document.getElementById('selectedBook').innerHTML = bookData; 
    }

    function addISBNclickEvents() {
        const viewButtons = document.querySelectorAll('.isbn-link')
        for(let item of viewButtons) {
            item.addEventListener('click', anchorClicked)
        }
    }

    function loadBooks(xml) {
        const books = xml.getElementsByTagName("book"); 
        for(let book of books){
            let newRow = document.createElement('tr')
            let isbnData = document.createElement('td')
            isbnData.classList.add('isbn-link')
            let titleData = document.createElement('td')
            let descriptionData = document.createElement('td')
            let pagesData = document.createElement('td')
            let authorData = document.createElement('td')

            let newISBN = book.getElementsByTagName('isbn')[0].childNodes[0].nodeValue;
            let newTitle = book.getElementsByTagName('title')[0].childNodes[0].nodeValue;
            let newDescription = book.getElementsByTagName('description')[0].childNodes[0].nodeValue;
            let newPages = book.getElementsByTagName('pages')[0].childNodes[0].nodeValue;
            let newAuthors = book.getElementsByTagName('authors')[0].childNodes[0].nodeValue;

            isbnData.innerHTML = newISBN;
            isbnData.dataset.name = 'ISBN'
            isbnData.dataset.value = newISBN;

            titleData.innerHTML = newTitle; 
            titleData.dataset.name = 'Title'
            titleData.dataset.value = newTitle;

            descriptionData.innerHTML = newDescription; 
            descriptionData.dataset.name = 'Description'
            descriptionData.dataset.value = newDescription;
            
            pagesData.innerHTML = newPages; 
            pagesData.dataset.name = 'Pages'
            pagesData.dataset.value = newPages;

            authorData.innerHTML = newAuthors; 
            authorData.dataset.name = 'Authors'
            authorData.dataset.value = newAuthors;

            newRow.append(isbnData, titleData, descriptionData, pagesData, authorData)
            bookTable.appendChild(newRow)
        }

        addISBNclickEvents()
    }

    fetch(fileName)
    .then(res => res.text())
    .then(data => {
        const domParser = new DOMParser(); 
        const xmlBooks = domParser.parseFromString(data, "text/xml")

        loadBooks(xmlBooks)
    })
  });

    
</script>
</html>